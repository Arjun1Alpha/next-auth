(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[222],{8620:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return I}});var s,n=t(9499),i=t(29),a=t(7794),c=t.n(a);t(7294);var o=t(7536),l="https://js.stripe.com/v3",d=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,u="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",p=function(){for(var e=document.querySelectorAll('script[src^="'.concat(l,'"]')),r=0;r<e.length;r++){var t=e[r];if(d.test(t.src))return t}return null},m=function(e){var r=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",t=document.createElement("script");t.src="".concat(l).concat(r);var s=document.head||document.body;if(!s)throw Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(t),t},h=function(e,r){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"1.46.0",startTime:r})},j=null,f=function(e,r,t){if(null===e)return null;var s=e.apply(void 0,r);return h(s,t),s},x=Promise.resolve().then(function(){var e;return null!==j?j:j=new Promise(function(e,r){if("undefined"==typeof window){e(null);return}if(window.Stripe,window.Stripe){e(window.Stripe);return}try{var t=p();t||(t=m(null)),t.addEventListener("load",function(){window.Stripe?e(window.Stripe):r(Error("Stripe.js not available"))}),t.addEventListener("error",function(){r(Error("Failed to load Stripe.js"))})}catch(s){r(s);return}})}),g=!1;x.catch(function(e){g||console.warn(e)});var v=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];g=!0;var s=Date.now();return x.then(function(e){return f(e,r,s)})},b=t(5547),y=t(6501),N=t(2130),w=t(8193),P=t(9327),S=t(1664),k=t.n(S),C=t(810),O=t(9703),_=t(5893);function q(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,s)}return t}function E(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?q(Object(t),!0).forEach(function(r){(0,n.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var F=function(){var e,r=(0,b.F)(),t=r.totalPrice,n=r.cartItems,a=r.setShowCart,l=r.toggleCartItemQuantity,d=r.onRemove,u=(0,o.cI)(),p=u.handleSubmit,m=u.register,h=u.formState.errors,j=(e=(0,i.Z)(c().mark(function e(r){var i,a,o,l,d,u,p,m,h,j,f;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.map(function(e){return{name:e.name,quantity:e.quantity,image:(0,C.gJ)(e),price:e.price}}),o={orderItems:i,shippingAddress:a=E({},r),itemsPrice:t,shippingPrice:0,totalPrice:t,isPaid:!1,paidAt:void 0},e.prev=3,e.next=6,(0,C.qC)("/api/orders",o);case 6:return l=e.sent,e.next=9,l.json();case 9:if(d=e.sent,console.log("orderResponse",l,"orderData",d),u=d.order._id,!l.error){e.next=17;break}return y.ZP.error(l.error),e.abrupt("return");case 17:y.ZP.success(d.msg);case 18:return e.next=20,s||(s=v("pk_live_51OqulRSIg6kBRictsjzCeR9aongtlBIslq5VVGKze2ablNB0U43S8PngQ5ylOQXQbHNSe8yb5Kw3WG0yeLtcQlkA0067bjXuBP")),s;case 20:return p=e.sent,e.next=23,(0,C.qC)("/api/stripe",{cartItems:n,orderId:u});case 23:return m=e.sent,e.next=26,m.json();case 26:if(h=e.sent,console.log("stripe res",m),console.log("stripe data",h),500!==m.statusCode){e.next=31;break}return e.abrupt("return");case 31:return y.ZP.loading("Redirecting to Stripe..."),e.next=34,(0,C.fP)("/api/orders/".concat(u,"/pay"),{orderId:u});case 34:return j=e.sent,e.next=37,j.json();case 37:f=e.sent,console.log(f.message),p.redirectToCheckout({sessionId:h.id}),e.next=45;break;case 42:e.prev=42,e.t0=e.catch(3),y.ZP.error((0,O.Z)(e.t0));case 45:case"end":return e.stop()}},e,null,[[3,42]])})),function(r){return e.apply(this,arguments)});return(0,_.jsx)("div",{className:"checkout-container",children:(0,_.jsxs)("form",{className:"shipping-form-container",onSubmit:p(j),children:[(0,_.jsx)("h1",{className:"checkout-title-text",children:"Shipping Address"}),(0,_.jsxs)("div",{className:"shipping-form-item",children:[(0,_.jsx)("label",{htmlFor:"fullName",children:"Full Name"}),(0,_.jsx)("input",E({id:"fullName",autoFocus:!0},m("fullName",{required:"Please enter full name"}))),h.fullName&&(0,_.jsx)("div",{className:"input-error-message",children:h.fullName.message})]}),(0,_.jsxs)("div",{className:"shipping-form-item",children:[(0,_.jsx)("label",{htmlFor:"address",children:"Address"}),(0,_.jsx)("input",E({id:"address"},m("address",{required:"Please enter address",minLength:{value:3,message:"Address is more than 2 chars"}}))),h.address&&(0,_.jsx)("div",{className:"input-error-message",children:h.address.message})]}),(0,_.jsxs)("div",{className:"shipping-form-item",children:[(0,_.jsx)("label",{htmlFor:"city",children:"City"}),(0,_.jsx)("input",E({id:"city"},m("city",{required:"Please enter city"}))),h.city&&(0,_.jsx)("div",{className:"input-error-message ",children:h.city.message})]}),(0,_.jsxs)("div",{className:"shipping-form-item",children:[(0,_.jsx)("label",{htmlFor:"postalCode",children:"Postal Code"}),(0,_.jsx)("input",E({id:"postalCode"},m("postalCode",{required:"Please enter postal code"}))),h.postalCode&&(0,_.jsx)("div",{className:"input-error-message ",children:h.postalCode.message})]}),(0,_.jsxs)("div",{className:"shipping-form-item",children:[(0,_.jsx)("label",{htmlFor:"country",children:"Country"}),(0,_.jsx)("input",E({id:"country"},m("country",{required:"Please enter country"}))),h.country&&(0,_.jsx)("div",{className:"input-error-message ",children:h.country.message})]}),(0,_.jsx)("h1",{className:"checkout-title-text",children:"Shopping Cart"}),n.length<1&&(0,_.jsxs)("div",{className:"empty-cart",children:[(0,_.jsx)(w.SLZ,{size:150}),(0,_.jsx)("h3",{children:"Your shopping bag is empty"}),(0,_.jsx)(k(),{href:"/shop",children:(0,_.jsx)("button",{type:"button",onClick:function(){return a(!1)},className:"btn",children:"Continue Shopping"})})]}),(0,_.jsxs)("div",{className:"checkout-cart-items-container",children:[(0,_.jsx)("div",{className:"product-container",children:n.length>=1&&n.map(function(e,r){return(0,_.jsxs)("div",{className:"product checkout-product",children:[(0,_.jsx)("img",{src:(0,N.u)(null==e?void 0:e.image[0]),alt:e.name,className:"cart-product-image"}),(0,_.jsxs)("div",{className:"item-desc",children:[(0,_.jsxs)("div",{className:"flex top",children:[(0,_.jsx)("h5",{children:e.name}),(0,_.jsxs)("h4",{children:["$",e.price]})]}),(0,_.jsxs)("div",{className:"flex bottom",children:[(0,_.jsx)("div",{children:(0,_.jsxs)("p",{className:"quantity-desc",children:[(0,_.jsx)("span",{className:"minus",onClick:function(){return l(e._id,"dec")},children:(0,_.jsx)(w.ywL,{})}),(0,_.jsx)("span",{className:"num",children:e.quantity}),(0,_.jsx)("span",{className:"plus",onClick:function(){return l(e._id,"inc")},children:(0,_.jsx)(w.Lfi,{})})]})}),(0,_.jsx)("button",{type:"button",className:"remove-item",onClick:function(){return d(e)},children:(0,_.jsx)(P.OZs,{})})]})]})]},e._id)})}),n.length>=1&&(0,_.jsxs)("div",{className:"checkout-cart-bottom",children:[(0,_.jsxs)("div",{className:"total",children:[(0,_.jsx)("h3",{children:"Subtotal:"}),(0,_.jsxs)("h3",{children:["$",t]})]}),(0,_.jsx)("div",{className:"place-order-button",children:(0,_.jsx)("button",{className:"btn",children:"Place Order"})})]})]})]})})};F.auth=!0;var I=F},5248:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout",function(){return t(8620)}])}},function(e){e.O(0,[536,774,888,179],function(){return e(e.s=5248)}),_N_E=e.O()}]);